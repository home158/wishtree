(function(b){var a="contextMenu";b.fn[a]=function(d){if(typeof d=="string"){var c=b.fn[a].publicMethods[d];if(c){var e=Array.prototype.slice.call(arguments,1);return this.each(function(){c(this,e)})}else{return this[a](d,e)}}d=d||{};return this.each(function(){var f=b.data(this,a);if(f){b.extend(true,{},f.options,d)}else{var h={options:b.extend(true,{},b.fn[a].defaults,d)};var g=b.extend(true,{},b.fn[a].base,h);b.data(this,a,g)}b.fn[a].internalMethods.init(this)})};b.fn[a].internalMethods={init:function(d){var c=this;base=c.getData(d),base.$elem=b(d),base.options.theme="theme-"+base.options.theme,d.contextmenu=this;base.$appendTo=b(base.options.appendTo);if(base.options.buttonMode===true){this.displayContextmenuByDefault(d)}else{base.$elem.bind("contextmenu",{elem:d,that:this},this.showContextmenu)}},getData:function(c){return b.data(c,a)},showContextmenu:function(i){var f=i.data.that,d=i.data.elem,g=f.getData(d),h=g.options.theme,c=g.options.buttonMode;g.$menu=f.createMenu(d,g.options.menu,b(g.options.appendTo),true,g);if(g.$menu){f.show(d,i);g.$menu.on("mousedown",function(j){j.preventDefault();return false});f.bindCloseContextMenuEvent(d)}},bindCloseContextMenuEvent:function(d){var c=this,e=c.getData(d);if(e.options.buttonMode===true){b(document).unbind("mousedown",c.hideButtonModeContextMenuHandler).bind("mousedown",{elem:d,that:c},c.hideButtonModeContextMenuHandler);b(document).unbind("closeContextMenu",c.hideButtonModeContextMenuHandler).bind("closeContextMenu",{elem:d,that:c},c.hideButtonModeContextMenuHandler)}else{b(document).unbind("mousedown",c.hideRightClickContextMenuHandler).one("mousedown",{elem:d,that:c},c.hideRightClickContextMenuHandler);b(document).unbind("closeContextMenu",c.hideRightClickContextMenuHandler).one("closeContextMenu",{elem:d,that:c},c.hideRightClickContextMenuHandler)}},unbindCloseContextMenuEvent:function(d){var c=this,e=c.getData(d);if(e.options.buttonMode===true){b(document).unbind("mousedown",c.hideButtonModeContextMenuHandler);b(document).unbind("closeContextMenu",c.hideButtonModeContextMenuHandler)}else{b(document).unbind("mousedown",c.hideRightClickContextMenuHandler);b(document).unbind("closeContextMenu",c.hideRightClickContextMenuHandler)}},hideButtonModeContextMenuHandler:function(d){var c=d.data.that;c.hideContextMenuHandler(d)},hideRightClickContextMenuHandler:function(d){var c=d.data.that;c.hideContextMenuHandler(d)},hideContextMenuHandler:function(g){var d=g.data.that,c=g.data.elem,f=d.getData(c);d.hide(c,b(f.options.appendTo))},show:function(d,g){var c=this,f=c.getData(d);var h=this.getRootMenuPosition(d,g);f.$menu.css({top:h.y,left:h.x,position:"absolute",zIndex:99})},createMenu:function(f,e,k,o,d){var j=this,c=[],m=b("<div/>"),i=e.length>0?e[0].GROUP:0,n=true,g=b("<ul/>").appendTo(m),l=function(p){if(document.all&&!document.querySelector){var q=p.outerWidth();p.find("li .menu-item").width(q-23)}},h=(d.options.separator&&o&&d.options.buttonMode===true);if(o===true){if(d.options.buttonMode){m.addClass(d.themePrefix+"-button").addClass(d.options.theme)}else{m.addClass(d.themePrefix).addClass(d.options.theme)}}else{m.on("mousedown",function(p){p.preventDefault();return false})}m.addClass("sub-menu");b.each(e,function(s,p){if(p.RBA_MODEL&&b.isFunction(d.options.RBA_MODEL._GLOBAL)){d.options.RBA_MODEL._GLOBAL(p,d)}if(p.RBA_MODEL&&b.isFunction(d.options.RBA_MODEL[p.RBA_MODEL])){d.options.RBA_MODEL[p.RBA_MODEL](p,d)}if(!p.CHILD){p=b.extend(true,{},d.defaultMenu,p)}if(p.VISIBLE!==false){var u=b("<li/>");if(i!=p.GROUP){if(n==false){b("<li/>").appendTo(g).on("click",function(z){z.preventDefault();return false}).append(b("<div/>").addClass(d.classSeparator))}i=p.GROUP}if(p.TEXT){var x='<span class="menu-text">'+p.TEXT+"</span>";var v=b("<div/>").addClass(d.classMenuItem).html(x).appendTo(u);if(p.CHILD){var t=0;b.each(p.CHILD,function(z,A){if(A.VISIBLE!==false){t++}});if(t!=0&&p.DISABLED!==true){v.addClass(d.classSubMenuIndicator)}else{v.addClass(d.classMenuDisabled)}}if(p.BACKGROUND_POSITION){if(p.DISABLED===true){c=p.BACKGROUND_POSITION.GRAYOUT}else{c=p.BACKGROUND_POSITION.DEFAULT}c[0]=parseInt(c[0],10).toString()+"px";c[1]=parseInt(c[1],10).toString()+"px";var w=b("<span/>").addClass("menu-image").css({"background-position":c.join(" ")}).appendTo(v)}if(p.BACKGROUND_IMG){var w=b("<span/>").addClass("menu-image").css({"background-position":"0px 0px","background-image":"url("+d.absoluteUrlFolderPath+p.BACKGROUND_IMG+")"}).appendTo(v)}v.find("span:eq(0)").appendTo(v);if(p.DISABLED===true){u.find("> div").addClass(d.classMenuDisabled);if(p.CHILD){v.addClass(d.classSubMenuIndicatorGray)}}else{if(b.isFunction(p.ONCLICK)){u.on("click",{o:p},function(B){B.data.o.ONCLICK(B.data.o,d);var A=b(this).closest("div."+d.themePrefix+"."+d.options.theme);var z=A.find("> ul > li > div.menu-item");var C=A.find("li div.sub-menu");if(b(this).siblings().find(" > div.sub-menu").length==0){z.removeClass(d.classMenuItemHover)}if(!B.data.o.CHILD&&d.options.buttonMode===true){if(b(this).siblings().find(" > div.sub-menu").length==0){b(this).find(" > div.menu-item").addClass(d.classMenuItemHover)}B.preventDefault();return false}})}u.on("click",{o:p,buttonMode:d.options.buttonMode},function(B){if(B.data.buttonMode===true){var A=b(this).closest("div."+d.themePrefix+"-button."+d.options.theme);var z=A.find("> ul > li > div.menu-item");var C=A.find("li div.sub-menu");if(p.CHILD){B.preventDefault();return false}if(!b.isFunction(p.ONCLICK)){B.preventDefault();return false}if(z.hasClass(d.classMenuItemHover)&&C.length==0){B.preventDefault();return false}if(C.length>0){j.hide(f,b(d.options.appendTo),C);z.removeClass(d.classMenuItemHover);B.preventDefault();return false}}else{if(p.CHILD){B.preventDefault();return false}if(!b.isFunction(p.ONCLICK)){B.preventDefault();return false}j.hide(f,b(d.options.appendTo),b(this))}})}}if(p.DISABLED!==true){u.hover(function(z){if(d.options.buttonMode===true&&o===true){b(this).parent().siblings().find("div.sub-menu").remove()}b(this).find("> div.menu-item").addClass(d.classMenuItemHover)},function(){b(this).find("> div").removeClass(d.classMenuItemHover);b(this).siblings().find("> div").removeClass(d.classMenuItemHover)});if(p.CHILD){if(d.options.buttonMode!==true||o!=true){u.hover(function(A){var z=j.createMenu(f,p.CHILD,b(this),false,d),B=j.getSubMenuPosition(f,A,b(this));if(d.options.buttonMode===false){z.css({left:B.x,top:B.y})}else{if(o!==true){z.css({left:B.x,top:B.y})}}l(z)},function(A){var z=b(this).find("div.sub-menu");setTimeout(function(){z.remove()},d.options.hoverTimeout)})}if(d.options.buttonMode===true&&o===true){var y=0;u.on("mousedown",function(z){y=b(this).find("div.sub-menu").length}).on("click",function(E){var F=b(this).closest("div."+d.themePrefix+"-button."+d.options.theme);var G=F.find("li div.sub-menu");if(G.length==0&&y===0){var B=j.createMenu(f,p.CHILD,b(this),false,d);l(B);var z=b(window),H=z.width(),C=z.scrollLeft(),A=B.outerWidth(),D=H+C;$liLeft=u.position().left;if(($liLeft+A)>D){B.css({left:D-A-1})}else{B.css({left:($liLeft>=C?$liLeft:C+1)})}j.bindCloseContextMenuEvent(f)}else{F.find("> ul > li > div.menu-item").removeClass(d.classMenuItemHover)}})}}}if(h&&!n){var r=b("<li/>").appendTo(g),q=b("<div/>").addClass("v-separator"),x='<span class="menu-text">&nbsp;</span>';q.append(x).appendTo(r);r.appendTo(g)}n=false;u.appendTo(g)}});k.append(m);if(o&&d.options.buttonMode!==true){l(m)}m.bind("contextmenu",function(p){p.preventDefault()});return m},disableSelection:function(d,f){var c=this,e=c.getData(d);b.each(f,function(g,h){b(h).attr("unselectable","on").css({"-moz-user-select":"none","-o-user-select":"none","-khtml-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none"}).attr("unselectable","on").on("selectstart",function(){return false})})},getRootMenuPosition:function(f,n){var l=this,c=l.getData(f),d=c.$menu;var p=n.pageX,o=n.pageY,i=b(window),q=d.width(),k=d.height(),j=i.width(),g=i.height(),m=p+q-i.scrollLeft(),r=o+k-i.scrollTop();if(m>j){p-=(m-j+5)}if(r>g){o-=(r-g+5)}return{x:p,y:o}},getSubMenuPosition:function(B,z,d){var k=this,j=k.getData(B);var g=d.find("div.sub-menu"),p=g.find("div.menu-item"),s=parseInt(p.css("paddingTop"),10),A=parseInt(p.css("border-top-width"),10)||0,n=d.offset().left,t=s+A,m=d.offset().top,C=d.position().top-t,i=g.outerWidth(),q=g.outerHeight(),o=d.width(),v=d.height(),u=b(window),D=u.width(),f=u.height(),c=n+o+i-u.scrollLeft(),l=m+v+q-u.scrollTop();if(c>D){o=-i}if(l-f>10){m=C-(l-f)+v-10}else{m=d.position().top-s+A}var r=parseInt(d.find("> div.menu-item").css("paddingTop"),10);return{x:o,y:m}},hide:function(g,c,d){var f=this,h=f.getData(g),i=h.options.theme,e=h.options.buttonMode;if(d){if(e===false){d.closest("div."+h.themePrefix+"."+h.options.theme).remove()}else{d.closest("div."+h.themePrefix+"-button."+i).find("> ul > li > div.sub-menu").remove()}}else{if(e===false){c.find("div."+h.themePrefix+"."+i).remove()}else{c.find("div."+h.themePrefix+"-button."+i).find("> ul > li > div.sub-menu").remove()}}f.unbindCloseContextMenuEvent(g);if(b.isFunction(h.options.hideContextMenu)){h.options.hideContextMenu()}},displayContextmenuByDefault:function(d){var c=this,e=c.getData(d);e.$elem.empty();e.$menu=c.createMenu(d,e.options.menu,e.$elem,true,e)},reload:function(e,c){var d=this,f=d.getData(e);f.options=b.extend(true,{},f.options,c);this.displayContextmenuByDefault(e)}};b.fn[a].publicMethods={reload:function(d,c){b.fn[a].internalMethods.reload(d,c[0])}};b.fn[a].defaults=b.extend({},{buttonMode:false,appendTo:"body",theme:"tm",hoverTimeout:120,RBA_MODEL:{_GLOBAL:function(d,c){}},separator:true});b.fn[a].base=b.extend({},{themePrefix:"trend-context-menu",classMenuItem:"menu-item",classMenuItemHover:"menu-item-hover",classSeparator:"dot-line-separator",classSubMenuIndicator:"sub-menu-indicator",classSubMenuIndicatorGray:"sub-menu-indicator-gray",classImgDefault:"menu-default",classMenuDisabled:"menu-item-disabled",absoluteUrlFolderPath:document.location.protocol+"//"+document.location.host+document.location.pathname+"/../",defaultMenu:{ONCLICK:function(){}},hideContextMenu:function(){}})})(jQuery);