(function(b){var a="trendGrid";b.fn[a]=function(d){if(typeof d=="string"){var c=b.fn[a].publicMethods[d];if(c){var e=Array.prototype.slice.call(arguments,1);return this.each(function(){c(this,e)})}else{b.error("Method '"+d+"' doesn't exist for "+a+" plugin.");return true}}d=d||{};return this.each(function(){var f=b.data(this,a);if(f){b.error("Plugin '"+a+"' can't be triggered twice. Please use other methods to re-render grid.")}else{var h={options:b.extend(true,{},b.fn[a].defaults,d)};var g=b.extend(true,{},b.fn[a].base,h);b.data(this,a,g)}b.fn[a].internalMethods.init(this)})};b.fn[a].internalMethods={init:function(d){var c=this;base=c.getData(d),base.$elem=b(d),base.elemId=base.$elem.attr("id");if(base.options.elemHeight!=null){base.$elem.height(base.options.elemHeight)}this.ajaxLoading(d);this.preventContextMenu(d);this.prepareElements(d);this.setupDefaultProperty(d);this.renderHeaderColumns(d);base.$contentScrollerWrap.bind("scroll",{elem:d,that:this},this.contentScrollingHandle);base.$contentScrollerWrap.on("scrollstop",{elem:d,that:this},this.contentScrollStopHandle);this.rowSelectable(d);this.renderContentCells(d);this.ajaxLoadingComplete(d)},getData:function(c){return b.data(c,a)||{}},getOptions:function(d,c){c(this.getData(d).options)},preventContextMenu:function(d){var c=this,e=c.getData(d);e.$elem.unbind("contextmenu").bind("contextmenu",function(f){f.preventDefault(f);return false})},prepareElements:function(d){var c=this,e=c.getData(d);e.$headerScrollerWrap=b("<div/>").addClass("headerScrollerWrap").appendTo(e.$elem);e.$header=b("<div/>").addClass("header").appendTo(e.$headerScrollerWrap);e.$contentScrollerWrap=b("<div/>").addClass("contentScrollerWrap").appendTo(e.$elem);e.$content=b("<div/>").addClass("content").appendTo(e.$contentScrollerWrap);this.disableSelection(d,[e.$header,e.$content,e.$contentScrollerWrap])},disableSelection:function(d,f){var c=this,e=c.getData(d);b.each(f,function(g,h){b(h).attr("unselectable","on").css({"-moz-user-select":"none","-o-user-select":"none","-khtml-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none"}).attr("unselectable","on").on("selectstart",function(){return false})})},setupDefaultProperty:function(e){var d=this,f=d.getData(e),c=f.options.columns;f.options.columnsMinWidth=Math.max(f.columnWidthdiff,f.options.columnsMinWidth);f.prefixID="row_"+this.randomString(d,8)+"_";f.scrollRight=f.scrollLeft+f.$contentScrollerWrap.outerWidth();f.perPageRows=Math.ceil((this.getContentHeight(e)-f.headerHeight)/f.options.rowHeight);if(f.options.dragSelect.dragColumnId==null){f.options.dragSelect.dragColumnId=f.options.columns[0].id}if(f.options.columnsType==2){this.adjColumnPercentageWidth(e)}this.setupDefaultRange(e);this.createStyleNode(e);f.visibleRange.bottom=Math.min(f.options.rowRecords,f.perPageRows)-1},randomString:function(g,f){var e=this,h=e.getData(g);var d="abcdefghiklmnopqrstuvwxyz".split("");if(!f){f=Math.floor(Math.random()*d.length)}var j="";for(var c=0;c<f;c++){j+=d[Math.floor(Math.random()*d.length)]}return j},getContentHeight:function(d){var c=this,e=c.getData(d);return parseFloat(b.css(e.$elem[0],"height",true))},getContentScrollerWrapHeight:function(d){var c=this,e=c.getData(d);return e.$elem.height()-e.$header.height()},setupDefaultRange:function(e){var d=this,f=d.getData(e);if(f.options.scrollRowsBuffer==null){f.options.scrollRowsBuffer=Math.ceil(f.perPageRows/2)}var c=f.perPageRows+f.options.scrollRowsBuffer;f.renderRange=b.extend(true,{},{top:0,bottom:c})},createStyleNode:function(e){var d=this,f=d.getData(e);f.ss1=document.createElement("style");f.ss1.setAttribute("type","text/css");f.ss1.setAttribute("id",f.elemId+"_css");var c=document.getElementsByTagName("head")[0];c.appendChild(f.ss1)},renderHeaderColumns:function(g){var f=this,h=f.getData(g),e=h.options.columns,d=h.columnWidthdiff,c;h.$header.empty();h.columnsIdArray=[];h.headerTotalWidth=0;b.each(e,function(j,k){k=e[j]=b.extend(true,{},h.options.columnDefaults,e[j]);if(k.width==undefined){k.width=h.options.columnDefaults.width}if(k.width<h.options.columnsMinWidth){k.width=h.options.columnsMinWidth}c=b("<div/>").width(k.width-d).html("<span class='column-name'>"+k.name+"</span>").attr("name","column_"+j);if(h.options.showTip){c.attr("title",k.name)}c.addClass("column column-ellipsis").appendTo(h.$header);if(h.options.columnSort.disabled===false){c.hover(function(){b(this).addClass("column-hover")},function(){b(this).removeClass("column-hover")})}h.headerTotalWidth+=k.width;h.columnsIdArray.push("column_"+j)});if(h.scrollRight>h.headerTotalWidth){var i=h.headerTotalWidth-h.$contentScrollerWrap.outerWidth();h.$headerScrollerWrap[0].scrollLeft=i;h.$contentScrollerWrap[0].scrollLeft=i}this.autoFitColumn(g);this.setStyleRule(g);if(h.options.columnResize.disabled===false){this.columnResizable(g)}if(h.options.columnReorder.disabled===false){this.columnReorderable(g)}if(h.options.columnSort.disabled===false){this.columnSortable(g)}},autoFitColumn:function(e){var h=this,c=h.getData(e);if(c.options.autoFitColumn==true){var f=0,j=c.$elem.outerHeight(),g=c.$header.outerHeight(),k=j-g,d=c.options.columns[c.options.columns.length-1],i=c.$header.children().last();if(c.options.rowRecords>=c.perPageRows){c.$contentScrollerWrap.css("height",k);f=c.$elem.width()-this.scrollbarWidth(e)}else{f=c.$contentScrollerWrap.outerWidth()}var l=f-c.headerTotalWidth;if(l>0){i.width(l+d.width-c.columnWidthdiff);d.width=l+d.width}}},scrollbarWidth:function(g){var f=this,h=f.getData(g);var e=b('<div style="width:50px;height:50px;overflow:hidden;position:absolute;top:-200px;left:-200px;"><div style="height:100px;"></div>');e.css("overflow-y","scroll");b("body").append(e);var d=e.width();var c=b("div",e).innerWidth();e.remove();return(50-c)},getVisibleColumnRange:function(f){var e=this,g=e.getData(f),h=0,d,c=0;if(g.scrollLeft==0){h=0}b.each(g.options.columns,function(j,k){if(c<g.scrollRight){if(c<g.scrollLeft){h=j}if(c<g.scrollRight){d=j}}c+=k.width});g.renderColumnRange.top=h;g.renderColumnRange.bottom=d},columnResizable:function(g){var j=this,d=j.getData(g),n=0,m,i,h,e=d.$header.children(),l=d.$content.offset().left,f=d.options.columnsMinWidth,k=b('<div class="drag-line"/>'),r,q;b.each(e,function(s,t){if(!(d.options.columnsType===2&&s===e.length-1)){var c=b('<div class="resizable-handle column-right"/>'),u=s;c.off("click").on("dragstart",function(y,v){j.removeContextMenu(g);b.each(e,function(z,A){d.options.columns[z].originalWidth=b(A).outerWidth()});var w=0;r=d.options.columns[s];if(d.options.columnsType===2){q=d.options.columns[s+1]}for(var x=0;x<=s;x++){m=d.options.columns[x];w+=m.originalWidth-d.options.columnsMinWidth}i=y.pageX-w;l=d.$content.offset().left;h=d.$headerScrollerWrap[0].scrollLeft;k.css("left",v.offsetX-l+b(this).width()-h).appendTo(d.$elem)}).on("drag",function(x,w){var v,y=w.deltaX;if(y<0){if(d.options.columnsType===1){if(y&&(r.originalWidth+y)<f){r.width=f+n}else{r.width=r.originalWidth+y+n}}else{if(y&&(r.originalWidth+y)<f){r.width=f+n;q.width=q.originalWidth+(r.originalWidth-f)+n}else{r.width=r.originalWidth+y+n;q.width=q.originalWidth-y+n}}}else{if(d.options.columnsType===1){d.options.columns[s].width=r.originalWidth+y+n}else{if((q.originalWidth-y)<f){q.width=f+n;r.width=r.originalWidth+(q.originalWidth-f)+n}else{q.width=q.originalWidth-y+n;r.width=r.originalWidth+y+n}}}v=j.setHeaderColumnWidth(g);k.css("left",v[u]-h)}).on("dragend",function(x,w){j.setStyleRule(g);j.setupContentWidth(g);if(d.options.columnsType===2){var z,v,A=r.width+q.width,y=parseInt(r.percentageWidth.replace("%",""))+parseInt(q.percentageWidth.replace("%",""));z=Math.floor((r.width*y)/A);r.percentageWidth=z+"%";v=y-z;q.percentageWidth=v+"%"}b(this).css({left:""});d.options.columnResize.stop(d.options);k.remove();d.triggerMouseUp=false;d.options.autoFitColumn=false;d.$headerScrollerWrap[0].scrollLeft=d.$contentScrollerWrap[0].scrollLeft;d.scrollLeft=d.$headerScrollerWrap[0].scrollLeft;d.scrollRight=d.scrollLeft+d.$contentScrollerWrap.outerWidth();j.getVisibleColumnRange(g);setTimeout(function(){j.createCells(g)},d.scrollRenderRowsTimeout)}).appendTo(t)}})},contentScrollingHandle:function(h){var f=h.data.that,d=h.data.elem,g=f.getData(d),i,c;g.scrollCFG=true;g.scrollTop=this.scrollTop;g.scrollLeft=this.scrollLeft;g.clientWidth=this.clientWidth;g.$headerScrollerWrap[0].scrollLeft=g.scrollLeft;if(g.scrollTop!==g.prevScrollTop){f.removeContextMenu(d);g.vDiff=g.scrollTop-g.prevScrollTop;g.absScrollDiff=Math.abs(g.vDiff);g.visibleRange.top=Math.max(Math.ceil(g.scrollTop/g.options.rowHeight)-1,0);g.visibleRange.bottom=Math.min(Math.ceil((g.scrollTop+g.$contentScrollerWrap.height())/g.options.rowHeight)+1,g.options.rowRecords);f.dynamicRequestLoading(d)}if(g.scrollLeft!==g.prevScrollLeft){b(".node",g.$content).width(g.scrollLeft+g.clientWidth);c=g.scrollLeft-g.prevScrollLeft;g.scrollRight=g.scrollLeft+g.$contentScrollerWrap.outerWidth()}},contentScrollStopHandle:function(h){var f=h.data.that,d=h.data.elem,g=f.getData(d),i,c;g.scrollCFG=false;g.scrollTop=this.scrollTop;g.scrollLeft=this.scrollLeft;if(g.scrollLeft!==g.prevScrollLeft){f.getVisibleColumnRange(d);setTimeout(function(){f.createCells(d)},g.scrollRenderRowsTimeout);g.prevScrollLeft=g.scrollLeft}if(g.scrollTop!==g.prevScrollTop){g.vDiff=g.scrollTop-g.prevScrollTop;g.absTopPosition+=g.vDiff;setTimeout(function(){if(g.scrollCFG===true){return false}f.appendRow(d)},g.scrollRenderRowsTimeout);g.prevScrollTop=g.scrollTop}},setHeaderColumnWidth:function(f){var e=this,g=e.getData(f),d=g.$header.children(),h=new Array(),c=0;b.each(g.options.columns,function(j,k){c+=k.width;h.push(c);$columnElems=b(d[j]);if($columnElems.outerWidth()!==k.width){$columnElems.width(k.width-g.columnWidthdiff)}});return h},setupContentWidth:function(d){var c=this,e=c.getData(d);if(e.$content.width()!==this.getRowWidth(d)){e.$content.width(this.getRowWidth(d))}else{if(e.$content.hasClass("fake_redraw")){e.$content.removeClass("fake_redraw")}else{e.$content.addClass("fake_redraw")}}},setupDefaultContentHeight:function(e){var d=this,f=d.getData(e),c=this.getContentScrollerWrapHeight(e);f.$contentScrollerWrap.height(c);f.$content.height(c);f.contentHeight=c},getRowWidth:function(e){var d=this,f=d.getData(e),c=0;b.each(f.options.columns,function(g,h){c+=(h.width||f.options.columnDefaults.width)});return c},setStyleRule:function(g){var j=this,d=j.getData(g),i=0,f=this.getRowWidth(g),h=d.options.columns,l=d.elemId,m=d.ss1.styleSheet,c="";this.setHeaderColumnsLeftRight(g);b.each(h,function(e,q){c+="."+l+"_"+q.id+"{left:"+q.left+"px;right:"+q.right+"px;}"});var n=document.getElementsByTagName("head")[0];if(b.browser.msie){try{m=n.document.getElementById(d.elemId+"_css").styleSheet;m.cssText=c}catch(k){b(n).find("#"+d.elemId+"_css").empty().text(c)}}else{b(n).find("#"+d.elemId+"_css").empty().text(c)}},setHeaderColumnsLeftRight:function(f){var e=this,g=e.getData(f),h=0,d=this.getRowWidth(f),c=g.options.columns;b.each(c,function(j,k){k.left=h.toFixed(1);h+=k.width;d-=k.width;k.right=d.toFixed(1)})},renderContentCells:function(e){var d=this,f=d.getData(e);var c=f.renderRange;this.getVisibleColumnRange(e);if(c.bottom>f.options.rowRecords){c.bottom=f.options.rowRecords}this.renderRows(e)},renderRows:function(d){var c=this,e=c.getData(d);e.$content.empty();this.createRows(d);e.contentHeight=this.getContentScrollerWrapHeight(d);e.$contentScrollerWrap.height(e.contentHeight);e.$content.height(e.options.rowRecords*e.options.rowHeight);e.$content.width(this.getRowWidth(d))},createRows:function(g){var l=this,e=l.getData(g),f,d,m,n,c,s,r=false,j,k=e.renderRange,q;e.renderRange=b.extend({},e.renderRange,k);this.setuprowRecords(g);if(e.options.rowRecords===0){q='<div class="emptyContentDescription">'+e.options.emptyContentDescription+"</div>";e.$content.html(q)}else{if(e.options.dynamicRequestData.disabled===false&&k.bottom<=e.options.rowRecords){for(var h=k.top;h<k.bottom;h++){if(!e.options.data[h]){e.requestRange.top=h;r=true;break}}for(var h=k.bottom-1;h>k.top;h--){if(!e.options.data[h]){e.requestRange.bottom=h;r=true;break}}if(r){e.options.dynamicRequestData.request(e)}else{this.appendRows(g);this.ajaxLoadingComplete(g,{delay:0})}}else{this.appendRows(g);if(!r){this.ajaxLoadingComplete(g,{delay:0})}}}},dynamicRequestLoading:function(d){var c=this,e=c.getData(d),f=e.options.scrollRowsBuffer*e.options.rowHeight;if(e.vDiff>=f){this.ajaxLoadingAsScrollingDown(d)}if(e.vDiff<=-1*f){this.ajaxLoadingAsScrollingUp(d)}},setuprowRecords:function(d){var c=this,e=c.getData(d);if(e.options.rowRecords<e.perPageRows){e.renderRange.bottom=e.perPageRows}if(e.options.rowRecords<e.perPageRows){e.$contentScrollerWrap.css("overflow-y","hidden")}else{e.$contentScrollerWrap.css("overflow-y","auto")}},appendRows:function(F,G){var q=this,m=q.getData(F),r=m.arrRowsSelected.length,d,v=m.options.scrollRowsBuffer*m.options.rowHeight,l=m.options,I;if(Math.abs(m.vDiff)<Math.abs(v)){G=false}function J(M){var j=b(M.elem);function L(e,i){if(i===true||!j.hasClass(m.classUIselected)){j.addClass(m.classUIselected).children().filter(function(){return m.classCustomCell.test(b(this).attr("class"))}).addClass(m.classUIselected).addClass(m.classCellhasCustom);m.arrRowsSelected.push(e)}else{j.removeClass(m.classUIselected).children().filter(function(){return m.classCustomCell.test(b(this).attr("class"))}).removeClass(m.classUIselected).removeClass(m.classCellhasCustom);m.arrRowsSelected=b.grep(m.arrRowsSelected,function(O){return O!=e});m.options.unSelected(m)}}function N(e){m.arrRowsSelected.push(e)}if(M.isHoldCtrlKey){L(M.index)}else{if(M.isHoldShiftKey){M.$content.find("div").removeClass(m.classUIselected);m.arrRowsSelected=[];if(M.end>M.start){if(M.start<m.renderRange.top){for(var k=m.renderRange.top;k<=M.end;k++){j=b("#"+m.prefixID+k,M.$content);if(j){L(k)}}for(var k=M.start;k<m.renderRange.top;k++){N(k)}}else{for(var k=M.start;k<=M.end;k++){j=b("#"+m.prefixID+k,M.$content);if(j){L(k)}}}}else{if(m.renderRange.bottom<M.start){for(var k=m.renderRange.bottom;k>=M.end;k--){j=b("#"+m.prefixID+k,M.$content);if(j){L(k)}}for(var k=M.start;k>m.renderRange.bottom;k--){N(k)}}else{for(var k=M.end;k<=M.start;k++){j=b("#"+m.prefixID+k,M.$content);if(j){L(k)}}}}}else{m.arrRowsSelected=[];j.siblings().removeClass(m.classUIselected).children().filter(function(){return m.classCustomCell.test(b(this).attr("class"))}).removeClass(m.classUIselected).removeClass(m.classCellhasCustom);L(M.index,true)}}}function H(i){if(b(this).hasClass(m.classUIselected)&&m.triggerMouseUp){if(i.ctrlKey){m.firstHitRowIndex=i.data.index;J({elem:this,index:i.data.index,isHoldCtrlKey:true,$content:i.data.$content})}else{m.firstHitRowIndex=i.data.index;J({elem:this,index:i.data.index,$content:i.data.$content});m.options.onSelected(m)}}m.triggerMouseUp=false}function n(i){if(i.button===2){q.removeContextMenu(F)}if(!b(this).hasClass(m.classUIselected)){m.triggerMouseUp=false;if(i.ctrlKey&&m.options.multiSelect.disabled===false){m.firstHitRowIndex=i.data.index;J({elem:this,index:i.data.index,isHoldCtrlKey:true,$content:i.data.$content})}else{if(i.shiftKey&&m.options.multiSelect.disabled===false){J({elem:this,index:i.data.index,$content:i.data.$content});if(m.firstHitRowIndex===null){m.firstHitRowIndex=i.data.index}else{m.secondHitRowIndex=i.data.index}if(m.firstHitRowIndex!==m.secondHitRowIndex&&m.firstHitRowIndex!==null&&m.secondHitRowIndex!==null){J({elem:this,start:m.firstHitRowIndex,end:m.secondHitRowIndex,isHoldShiftKey:true,$content:i.data.$content})}}else{m.firstHitRowIndex=i.data.index;J({elem:this,index:i.data.index,$content:i.data.$content})}}m.options.onSelected(m);if(i.button===2){i.data.that.contextMenu(F,i);i.preventDefault(i);i.stopPropagation();return false}}else{if(i.button===2&&b(this).hasClass(m.classUIselected)){i.data.that.contextMenu(F,i);i.preventDefault(i);i.stopPropagation();return false}m.triggerMouseUp=true}}q.removeSiblingRows(F);if(G===true){var u=m.visibleRange}else{var u=m.renderRange}b("> div.row-fake",m.$content).remove();var f=document.createElement("div"),t=[],B=m.options.columns,D=m.options.data,K="";for(var z=u.top;z<u.bottom;z++){if(b("#"+m.prefixID+z,m.$content).length>0){continue}$row='<div class="row" row="'+z+'" id="'+m.prefixID+z+'" style="top:'+(z*m.options.rowHeight)+"px;height:"+m.options.rowHeight+"px;line-height:"+m.options.rowHeight+'px">';for(var x=m.renderColumnRange.top;x<=m.renderColumnRange.bottom;x++){p=B[x].id;if(m.options.showTip){if(D[z][p+"_TIP"]||D[z][p+"_TIP"]===""){K=D[z][p+"_TIP"]}else{if(D[z][p]){K=D[z][p]}else{K=""}}$row+='<div class="cell '+m.elemId+"_"+p+'" cell="'+x+'" title="'+K+'"></div>'}else{$row+='<div class="cell '+m.elemId+"_"+p+'" cell="'+x+'"></div>'}}$row+="</div>";t.push($row)}f.innerHTML=t.join("");var c=document.createDocumentFragment(),s=function(){b(this).filter(function(){if(b(this).hasClass(m.classUIselected)){return false}else{if(b(this).hasClass(m.classRowFake)){return false}else{return true}}}).addClass(m.classUIhover).children().filter(function(){return m.classCustomCell.test(b(this).attr("class"))}).addClass(m.classUIhover)},h=function(){b(this).removeClass(m.classUIhover).children().filter(function(){return m.classCustomCell.test(b(this).attr("class"))}).removeClass(m.classUIhover)},y=function(i){if(i.button===2){b(i.currentTarget).contextMenu(m.options.contextMenu).off(i)}},C=m.options.cellsFormat;while(f.firstChild){$row=f.firstChild;if($row.tagName!="DIV"){continue}c.appendChild($row);$row=b($row);$row.hover(s,h);var g=parseInt($row.attr("row"));o=D[g];if(m.options.contextMenu&&!$row.hasClass(m.classRowFake)){$row.on("mousedown",y)}this.setHighLight(F,{$elem:$row,index:g,len:r});var A=$row.children("div");for(var x=m.renderColumnRange.top,w=0;x<=m.renderColumnRange.bottom;x++,w++){p=B[x].id;I=C[p];$cell=b(A[w]);try{if(b.isFunction(I)){htmlString=I({data:o,dataID:p,$row:$row,$cell:$cell,text:o[p]})}else{htmlString=o[p]}if(p!=m.options.dragSelect.dragColumnId){$cell.addClass(m.ClassUIdraggable)}}catch(E){$row.addClass(m.classRowFake);htmlString=""}tmp_htmlString=m.options.cellsFormat._GLOBAL({data:o,dataID:p,$row:$row,$cell:$cell,text:htmlString});if(typeof tmp_htmlString=="string"){htmlString=tmp_htmlString}if(p==m.options.dragSelect.dragColumnId&&!$row.hasClass(m.classRowFake)){if(typeof htmlString=="string"){htmlString='<span class="'+m.ClassUIdraggable+'">'+htmlString+"</span>"}else{htmlString=b('<span class="'+m.ClassUIdraggable+'"></span>').append(htmlString)}}if(typeof htmlString=="string"){A[w].innerHTML=htmlString}else{$cell.html(htmlString)}}if(m.options.rowSelect.disabled===false){if(!$row.hasClass(m.classRowFake)){if(o.disableSelection===true){$row.addClass(m.classRowFake)}else{$row.on("mouseup",{index:g,that:this,$content:m.$content},H).on("mousedown",{index:g,that:this,$content:m.$content},n)}}}}m.$content.append(c);q.ajaxLoadingComplete(F,{delay:0})},emptyContent:function(d){var c=this,e=c.getData(d);e.arrRowsSelected=[];e.$content.empty();e.options.data=[]},removeContent:function(d){var c=this,f=c.getData(d);try{f.$content.height(0);f.arrRowsSelected=[];f.$content.empty()}catch(g){}},renderContent:function(g,d){var f=this,h=f.getData(g);if(d){h.$headerScrollerWrap[0].scrollLeft=0;h.$contentScrollerWrap[0].scrollLeft=0;h.$contentScrollerWrap[0].scrollTop=0;h.options=b.extend(true,{},h.options,d);if(h.options.rowRecords<h.perPageRows||d.data.length<h.perPageRows){h.options.data=[]}if(d.data&&h.options.dynamicRequestData.disabled===false){this.removeContent(g);h.options.data=[]}h.options.data=b.extend(true,[],d.data);h.options.rowRecords=d.rowRecords;h.renderRange.top=0;h.renderRange.bottom=Math.ceil((h.absTopPosition+h.contentHeight)/h.options.rowHeight)+h.options.scrollRowsBuffer;h.scrollLeft=0;this.setuprowRecords(g);h.scrollLeft=0;this.renderContentCells(g)}else{var e=h.renderColumnRange.bottom;var c=h.renderColumnRange.top;h.scrollRight=h.scrollLeft+h.$contentScrollerWrap.outerWidth();this.getVisibleColumnRange(g);this.renderContentCells(g)}this.ajaxLoadingComplete(g,{delay:0})},removeSiblingRows:function(e){var d=this,g=d.getData(e),h=g.renderRange.top,c=g.renderRange.bottom,i,f;if(g.absScrollDiff>(g.contentHeight+g.options.scrollRowsBuffer*g.options.rowHeight)){g.$content.empty()}if(g.absScrollDiff<g.contentHeight){i=h-g.perPageRows;f=h-g.perPageRows;b.each(b("div.row",g.$content),function(j,k){if(b(k).attr("row")<h||b(k).attr("row")>c){b(k).remove()}})}},setHighLight:function(d,g){var c=this,f=c.getData(d);if(g.len!==0){if(b.inArray(g.index,f.arrRowsSelected)!=-1){g.$elem.addClass(f.classUIselected).children().filter(function(){return f.classCustomCell.test(b(this).attr("class"))}).addClass(f.classUIselected).addClass(f.classCellhasCustom)}}},contextMenu:function(d,g){var c=this,f=c.getData(d);f.options.onContextMenu(f,g)},columnReorderable:function(f){var e=this,h=e.getData(f),g,c,i,d=0;h.$header.children().on("draginit",function(k,j){e.removeContextMenu(f);if(b(k.target).hasClass("resizable-handle")){return false}d=h.$header.offset().left;i=k.offsetX||k.pageX-b(this).offset().left;b.drop({mode:"overlap",tolerance:function(m,l,n){var q=m.pageX>(n.left+n.width/2);b.data(n.elem,"drop+reorder",q?"insertAfter":"insertBefore");return this.contains(n,[m.pageX,m.pageY])}})}).on("dragstart",function(l,j){var k=b(this);g=k.clone().css({position:"absolute",zIndex:5}).addClass("ui-sortable-helper").appendTo(h.$header);c=k.clone().css("visibility","hidden").addClass("placeholder").insertAfter(k);k.css({display:"none"})}).on("drag",function(l,j){g.css({left:l.clientX-i-d});var k=j.drop[0],m=b.data(k||{},"drop+reorder");if(k&&(k!=j.current||m!=j.method)){c[m](k);b(this)[m](k);j.current=k;j.method=m;j.update()}}).on("dragend",function(q,j){b(this).css({display:"block"});c.remove();g.remove();var m=h.options.columns;var r=[];var l,k=h.$header.children(),n=[];b.each(k,function(s,t){l=b(t).attr("name");n.push(l)});if(JSON.stringify(h.columnsIdArray)!==JSON.stringify(n)){h.columnsIdArray=n;b.each(n,function(s,t){r.push(m[t.replace("column_","")])});h.options.columns=r;e.renderHeaderColumns(f);h.options.columnReorder.stop(h.options)}}).on("dropinit",function(k,j){return !(this==j.drag)}).on("dropend",function(k,j){})},columnSortable:function(f){var e=this,g=e.getData(f);if(g.options.sortColumnId===null){g.options.sortColumnId=g.options.columns[0].id}var c=g.$header.children(),d;b.each(c,function(h,j){d=g.options.columns[h];if(d.id===g.options.sortColumnId){e.insertIndicatorImages(f,{o:j,column:d,$header:g.$header})}b(j).on("click",{o:j,column:d,i:h,$header:g.$header},function(i){if(b(i.target).hasClass("resizable-handle")){return false}g.options.sortColumnId=i.data.column.id;if(i.data.column.sortAsc){i.data.column.sortAsc=g.options.columns[i.data.i].sortAsc=false}else{i.data.column.sortAsc=g.options.columns[i.data.i].sortAsc=true}e.insertIndicatorImages(f,{o:i.data.o,column:i.data.column,$header:i.data.$header});g.options.columnSort.stop(g.options,i.data.column.sortAsc)})})},insertIndicatorImages:function(f,h){var d=this,g=d.getData(f);var c;if(h.column.sortAsc){c=g.classIndicatorAsc}else{c=g.classIndicatorDesc}b(".indicator",h.$header).remove();b('<span class="indicator"/>').addClass(c).insertAfter(b(h.o).find("span"))},appendRow:function(d){var c=this,e=c.getData(d);this.getRenderAndVisibleRange(d);if(e.renderRange){this.createRows(d);e.absScrollDiff=0}},getRenderAndVisibleRange:function(e){var d=this,f=d.getData(e),g,c,h;f.perPageRows=Math.ceil(f.contentHeight/f.options.rowHeight);if(f.absScrollDiff<f.options.rowHeight){return false}g=Math.floor((f.absTopPosition)/f.options.rowHeight)-f.options.scrollRowsBuffer;if(g<0){g=0}c=Math.ceil((f.absTopPosition+f.contentHeight)/f.options.rowHeight)+f.options.scrollRowsBuffer;h=f.options.rowRecords;if(c>=h){c=h}f.renderRange={top:g,bottom:c};this.getVisibleRange(e)},getVisibleRange:function(d){var c=this,e=c.getData(d);e.visibleRange.top=Math.max(Math.ceil(e.scrollTop/e.options.rowHeight)-1,0);e.visibleRange.bottom=Math.min(Math.ceil((e.scrollTop+e.$contentScrollerWrap.height())/e.options.rowHeight)+1,e.options.rowRecords);return e.visibleRange},rowSelectable:function(g){var f=this,h=f.getData(g),d=false,c=false,e;if(h.options.rowSelect.disabled===true||h.options.multiSelect.disabled===true||h.options.dragSelect.disabled===true){h.$contentScrollerWrap.on("mousedown",function(){return false});return false}h.$contentScrollerWrap.on("mousedown",function(i){f.removeContextMenu(g);if(i.which!=1){return false}}).on("draginit",function(n,l){var k=b(n.target);if(n.which!=1){return false}b.drop({mode:"overlap",tolerance:null});if(h.options.rowSelect.disabled===true){return false}h.$content.children().off("dropstart").off("drop").off("dropend");if(h.triggerMouseUp==true){c=true;if(h.options.dragRows.disabled==true){if(k.parents().hasClass(h.ClassUIdraggable)||k.hasClass(h.ClassUIdraggable)){d=false}else{d=true}}else{d=false}}else{c=false;d=true;if(k.parents().hasClass(h.ClassUIdraggable)||k.hasClass(h.ClassUIdraggable)){c=true;d=false}}if(k.hasClass("contentScrollerWrap")||k.parents().hasClass(h.classRowFake)){d=true;c=false}if(k.hasClass(h.ClassUIdraggable)&&!k.parent().hasClass(h.classRowFake)){d=false}if(h.options.dragRows.disabled==true){c=false}if(d){var j=n.offsetX,r=n.offsetY;if(typeof n.offsetX=="undefined"){var q=h.$contentScrollerWrap.offset();j=n.pageX-q.left;r=n.pageY-q.top}if(j>b(n.currentTarget)[0].clientWidth){return false}if(r>b(n.currentTarget)[0].clientHeight){return false}f.getVisibleRange(g);for(var m=h.visibleRange.top;m<=h.visibleRange.bottom;m++){b("#"+h.prefixID+m,h.$content).filter(function(){return !b(this).hasClass(h.classRowFake)}).on("dropstart",function(s,i){b(this).addClass(h.classUIselectedd).children().filter(function(){return h.classCustomCell.test(b(this).attr("class"))}).addClass(h.classUIselectedd,h.classCellhasCustom)}).on("drop",function(s,i){b(this).addClass(h.classUIselected).children().filter(function(){return h.classCustomCell.test(b(this).attr("class"))}).addClass(h.classUIselected,h.classCellhasCustom);var t=parseInt(b(this).attr("row"),10);if(b.inArray(t,h.arrRowsSelected)===-1){h.arrRowsSelected.push(t)}}).on("dropend",function(s,i){b(this).removeClass(h.classUIselectedd).children().removeClass(h.classUIselectedd,h.classCellhasCustom)})}b.drop({multi:true,mode:"overlap"})}if(c&&!h.options.dropRows.disabled){b(h.options.dropRows.target).on("dropstart",function(s,i){if(!b(i.proxy).hasClass(h.options.dragRows.proxyClassName)){return false}b(this).addClass(h.options.dropRows.active)}).on("drop",function(s,i){h.options.dropRows.drop(s,b(this))}).on("dropend",function(){b(this).removeClass(h.options.dropRows.active)});b.drop({multi:false,mode:true})}}).on("dragstart",function(j,i){var k=h.options.dragRows.containment;if(d){if(j.ctrlKey===false){h.arrRowsSelected=[];h.$content.children().removeClass(h.classUIselected).children().filter(function(){return h.classCustomCell.test(b(this).attr("class"))}).removeClass(h.classUIselected).addClass(h.classCellhasCustom)}return b("<div />").addClass(h.options.dragSelect.proxyClassName).appendTo("body")}if(c){e=(b(k).length>0)?b(k):h.$elem[k]();return b("<div />").addClass(h.options.dragRows.proxyClassName).html(h.options.dragRows.text(h.arrRowsSelected)).appendTo("body")}if(c===false&&d===false){h.triggerMouseUp=false}}).on("drag",{distance:h.options.dragRows.distance},function(A,D){if(d){var s=b(D.proxy),w=b(this).offset().top,E=b(this).height(),z=b(this).offset().left,m=b(this).width(),y=Math.min(A.pageY,D.startY),i=Math.abs(A.pageY-D.startY),t=Math.min(A.pageX,D.startX),q=Math.abs(A.pageX-D.startX),j=parseInt(s.css("borderTopWidth"),10)+parseInt(s.css("borderBottomWidth"),10),n=parseInt(s.css("borderLeftWidth"),10)+parseInt(s.css("borderRightWidth"),10);if((w>y)||(w+E)<(y+i)){if(w>y){s.css({top:w,height:Math.abs(w-D.startY)})}if((w+E)<(y+i)){s.css({height:w+E-y-j})}}else{s.css({top:y,height:i})}if((z>t)||(z+m)<(t+q)){if(z>t){s.css({left:z,width:Math.abs(z-D.startX)})}if((z+m)<(t+q)){s.css({width:z+m-t-n})}}else{s.css({left:t,width:q})}}if(c){var s=b(D.proxy),y=A.pageY,t=A.pageX,i=s.outerHeight(),q=s.outerWidth(),l=parseInt(s.css("marginTop"),10),x=parseInt(s.css("marginLeft"),10),v=parseInt(s.css("marginBottom"),10),u=parseInt(s.css("marginRight"),10),C=e.offset().top,B=e.offset().left,k=e.outerHeight(),r=e.outerWidth();if(y<(C-l)){y=C-l}if(t<(B-x)){t=B-x}if((y+i+v)>(C+k)){y=C+k-i-v}if((t+q+u)>(B+r)){t=B+r-q-u}s.css({top:y,left:t})}}).on("dragend",function(j,i){if(d){b(i.proxy).remove()}if(c){b(i.proxy).fadeOut(h.options.dragRows.fadeOutDuration,function(){b(this).remove()})}if(d){h.$content.children().off("dropstart").off("drop").off("dropend")}if(c){b(h.options.dropRows.target).off("dropstart").off("drop").off("dropend")}b.drop({multi:false,mode:"overlap"});d=false;c=false;h.options.dragSelect.stop(h)})},registerRowsData:function(e,c){var d=this,f=d.getData(e);if(c.rowOffset){f.rowOffset=c.rowOffset}if(c.empty){f.options.data=[]}var g=f.rowOffset;if(typeof c.top!="undefined"&&c.top>=0){g=g+c.top;b.each(c.data,function(h,j){f.options.data[h+g]=b.extend(true,{},j)})}else{b.each(c.data,function(h,j){f.options.data.push(j)});f.options.rowRecords=f.options.data.length}},adjHeight:function(e,c){var d=this,f=d.getData(e);if(c<0){return false}if(!c){c=parseInt(f.$elem.height(),10)}else{f.$elem.height(c)}f.$contentScrollerWrap.height(c-f.headerHeight);f.contentHeight=c-f.headerHeight;f.absScrollDiff=c;this.appendRow(e);this.getRenderAndVisibleRange(e)},adjWidth:function(f,c){var e=this,g=e.getData(f),d=g.options.columns;if(c<0){return false}if(!c){c=parseInt(g.$elem.parent().width(),10)}g.$elem.width(c);if(g.options.columnsType==1){this.getVisibleColumnRange(f);this.createCells(f)}else{this.adjColumnPercentageWidth(f);this.setHeaderColumnWidth(f);this.setStyleRule(f);this.setupContentWidth(f)}},ajaxLoadingAsScrollingUp:function(h,d){var g=this,i=g.getData(h);i.$elem=b(h);if(i.$elem.find(".ajax-loading").length>0){return false}var e=b("<div/>").addClass("ajax-loading").css("background-image","none").appendTo(i.$elem);var f=b("<div/>").addClass("message").appendTo(e);this.disableSelection(h,e);var j=i.$header.height();var c=f.height()*2;e.css({top:j,height:c,width:i.$contentScrollerWrap[0].clientWidth});if(c>0){f.css({left:(e.width()-f.width())/2,top:(e.height()-f.height())/2})}e.css("width","0px")},ajaxLoadingAsScrollingDown:function(g){var f=this,h=f.getData(g);h.$elem=b(g);if(h.$elem.find(".ajax-loading").length>0){return false}var d=b("<div/>").addClass("ajax-loading").css("background-image","none").appendTo(h.$elem);var e=b("<div/>").addClass("message").appendTo(d);this.disableSelection(g,d);var c=e.height()*2;var i=h.$contentScrollerWrap[0].clientHeight+h.$header.height()-c;d.css({top:i,height:c,width:h.$contentScrollerWrap[0].clientWidth});if(c>0){e.css({left:(d.width()-e.width())/2,top:(d.height()-e.height())/2})}d.css("width","0px")},ajaxLoading:function(g,e){var f=this,h=f.getData(g),i="";h.$elem=b(g);if(h.$elem.find(".ajax-loading").length>0){return false}if(e){i=e.text}var c=b("<div/>").addClass("ajax-loading").appendTo(h.$elem);var d=b("<div/>").addClass("message").text(i).appendTo(c);this.disableSelection(g,c);d.css({left:(c.width()-d.width())/2,top:(c.height()-d.height())/2})},ajaxLoadingComplete:function(e,c){var d=this,g=d.getData(e);var f=g.ajaxLoadingRemoveTimeout;if(c&&c.delay){f=c.delay}setTimeout(function(){g.$elem.find("div.ajax-loading").remove()},f)},getSelected:function(f,d){var c=this,g=c.getData(f),i=function(j,e){return j-e},h=g.arrRowsSelected;if(h){d(h.sort(i))}else{d([])}},getSelectedInfo:function(g,f){var d=this,h=d.getData(g);var j=function(k,e){return k-e},i=h.arrRowsSelected;var c=[];b.each(i.sort(j),function(k,e){c.push(h.options.data[e])});f(c)},createCells:function(k){var r=this,g=r.getData(k),l=g.options.columns,d=l.length,h,f,t,u,c,v,q;if(g.options.rowRecords!==0){for(var n=g.renderRange.top;n<g.renderRange.bottom;n++){h=g.options.data[n];t=b("#"+g.prefixID+n,g.$content);if(t.children().length==d){continue}for(var m=g.renderColumnRange.top;m<=g.renderColumnRange.bottom;m++){if(t.find("> div[cell="+m+"]").length!=0){continue}f=l[m];c=g.options.cellsFormat[f.id];$cell=b("<div/>");try{if(b.isFunction(c)){u=c({data:h,dataID:f.id,$row:t,$cell:$cell,text:h[f.id]})}else{u=h[f.id]}if(f.id!=g.options.dragSelect.dragColumnId){$cell.addClass(g.ClassUIdraggable)}}catch(s){u=""}v=g.options.cellsFormat._GLOBAL({data:h,dataID:f.id,$row:t,$cell:$cell,text:u});if(typeof(v)==="string"){u=v}$cell.addClass("cell").attr("cell",m).addClass(g.elemId+"_"+f.id).html(u);t.append($cell);if(h){if(h.disableSelection===true){t.addClass(g.classRowFake)}}if(f.id==g.options.dragSelect.dragColumnId){if(typeof u==="string"){u='<span class="'+g.ClassUIdraggable+'">'+u+"</span>"}else{u=b('<span class="'+g.ClassUIdraggable+'"></span>').append(u)}$cell.html(u)}}b("."+g.classUIselected,g.$content).children().filter(function(){return g.classCustomCell.test(b(this).attr("class"))}).addClass(g.classUIselected).addClass(g.classCellhasCustom)}}},scrollTo:function(f,c){var e=this,g=e.getData(f),d=b.extend({},{x:false,y:false},c);if(d.x!==false){g.$headerScrollerWrap[0].scrollLeft=d.x;g.$contentScrollerWrap[0].scrollLeft=d.x}if(d.y!==false){g.$contentScrollerWrap[0].scrollTop=d.y;if(d.y===0){this.setupDefaultRange(f)}}},renderHeader:function(e,c){var d=this,f=d.getData(e);f.options.columns=c.columns;f.options.sortColumnId=c.sortColumnId;f.options.autoFitColumn=c.autoFitColumn;if(c.rowRecords){f.options.rowRecords=c.rowRecords}this.removeHeader(e);this.renderHeaderColumns(e);if(f.options.columnResize.disabled===false){}if(f.options.columnReorder.disabled===false){}if(f.options.columnSort.disabled===false){}},removeHeader:function(d){var c=this,e=c.getData(d);e.$header.empty()},refresh:function(f){var e=this,g=e.getData(f);if(g.options.dynamicRequestData.disabled===false){g.options.data=[]}var d=g.renderColumnRange.bottom;var c=g.renderColumnRange.top;g.scrollRight=g.scrollLeft+g.$contentScrollerWrap.outerWidth();this.getVisibleColumnRange(f);this.renderContentCells(f)},setOptions:function(e,c){var d=this,f=d.getData(e);b.extend(true,f.options,c)},getRenderRange:function(e,d){var c=this,f=c.getData(e);this.getRenderAndVisibleRange(e);d(f.renderRange)},removeRegisterRowsData:function(d){var c=this,e=c.getData(d);e.options.data=[]},cancelRowSelected:function(d){var c=this,e=c.getData(d);e.arrRowsSelected=[]},adjColumnPercentageWidth:function(h){var g=this,i=g.getData(h),e=i.options.columns,j=0,f=0,c=0,d=false;if(i.options.rowRecords>=i.perPageRows){j=i.$elem.width()-this.scrollbarWidth(h)}else{j=i.$contentScrollerWrap.outerWidth()}b.each(e,function(k,m){if(m.percentageWidth!=undefined){var l=parseInt(m.percentageWidth.replace("%",""));m.width=Math.floor(j*l/100);f+=l;c+=m.width}else{d=true}});if(!d&&f==100){if(j>c){e[e.length-1].width+=(j-c)}}},removeContextMenu:function(c){b(document).trigger("closeContextMenu")}};b.fn[a].publicMethods={removeRegisterRowsData:function(d,c){b.fn[a].internalMethods.removeRegisterRowsData(d,c[0])},registerRowsData:function(d,c){b.fn[a].internalMethods.registerRowsData(d,c[0])},ajaxLoading:function(d,c){b.fn[a].internalMethods.ajaxLoading(d,c[0])},ajaxLoadingComplete:function(d,c){b.fn[a].internalMethods.ajaxLoadingComplete(d,c[0])},appendRows:function(d,c){b.fn[a].internalMethods.appendRows(d,c[0])},adjHeight:function(d,c){b.fn[a].internalMethods.adjHeight(d,c[0])},adjWidth:function(d,c){b.fn[a].internalMethods.adjWidth(d,c[0])},emptyContent:function(d,c){b.fn[a].internalMethods.emptyContent(d)},removeContent:function(d,c){b.fn[a].internalMethods.removeContent(d)},getSelectedInfo:function(d,c){b.fn[a].internalMethods.getSelectedInfo(d,c[0])},getSelected:function(d,c){b.fn[a].internalMethods.getSelected(d,c[0])},scrollTo:function(d,c){b.fn[a].internalMethods.scrollTo(d,c[0])},renderHeader:function(d,c){b.fn[a].internalMethods.renderHeader(d,c[0])},renderContent:function(d,c){b.fn[a].internalMethods.renderContent(d,c[0])},refresh:function(d,c){b.fn[a].internalMethods.refresh(d)},setOptions:function(d,c){b.fn[a].internalMethods.setOptions(d,c[0])},getOptions:function(d,c){return b.fn[a].internalMethods.getOptions(d,c[0])},getRenderRange:function(d,c){b.fn[a].internalMethods.getRenderRange(d,c[0])},setupDefaultRange:function(d,c){b.fn[a].internalMethods.setupDefaultRange(d)},cancelRowSelected:function(d,c){b.fn[a].internalMethods.cancelRowSelected(d,c[0])},removeContextMenu:function(d,c){b.fn[a].internalMethods.removeContextMenu(d)}};b.fn[a].defaults=b.extend(true,{},{onSelected:function(c){},onContextMenu:function(d,c){},unSelected:function(c){},scrollRowsBuffer:100,rowHeight:24,autoFitColumn:false,showTip:true,emptyContentDescription:"",columnReorder:{disabled:false,stop:function(c){}},columnResize:{disabled:false,stop:function(c){}},columnSort:{disabled:false,stop:function(c,d){}},dynamicRequestData:{disabled:true,request:function(c){}},cellsFormat:{_GLOBAL:function(c){return c.text}},rowSelect:{disabled:false},multiSelect:{disabled:false},dragSelect:{disabled:false,proxyClassName:"dd-proxy-selecting",dragColumnId:null,stop:function(c){}},dragRows:{disabled:true,proxyClassName:"dd-proxy-dragging",distance:5,fadeOutDuration:"fast",containment:"parent",text:function(c){return"Move "+c.length+" target(s) "}},dropRows:{disabled:true,target:"span.node-icons-text",active:"ui-state-active",drop:function(c,d){}},sortColumnId:null,elemHeight:null,columnsType:1,columnsMinWidth:9,columnDefaults:{width:80}});b.fn[a].base=b.extend({},{prefixID:"",scrollLeft:0,ss1:null,columnsIdArray:[],columnWidthdiff:9,scrollTop:0,prevScrollTop:0,prevScrollLeft:0,absScrollDiff:0,scrollRenderRowsTimeout:150,absTopPosition:0,minWidth:0,classCustomCell:/cell-\w+/i,classCellhasCustom:"cell-custom",arrRowsSelected:[],renderColumnRange:{top:"",bottom:""},requestRange:{top:0,bottom:0},visibleRange:{top:0,bottom:0},headerHeight:25,classUIselected:"trend-ui-selected",classUIselectedd:"trend-ui-selectedd",ClassUIdraggable:"dd-draggable",classUIhover:"trend-ui-hover",classRowFake:"row-fake",triggerMouseUp:false,classIndicatorAsc:"asc",classIndicatorDesc:"desc",rowOffset:0,ajaxLoadingRemoveTimeout:100})})(jQuery);