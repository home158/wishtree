(function(b){var a="trendTree";b.fn[a]=function(d){if(typeof d=="string"){var c=b.fn[a].publicMethods[d];if(c){var e=Array.prototype.slice.call(arguments,1);return this.each(function(){c(this,e)})}else{b.error("Method '"+d+"' doesn't exist for "+a+" plugin.");return true}}d=d||{};return this.each(function(){var f=b.data(this,a);if(f){b.extend(true,{},f.options,d)}else{var h={options:b.extend(true,{},b.fn[a].defaults,d)};var g=b.extend(true,{},b.fn[a].base,h);b.data(this,a,g)}b.fn[a].internalMethods.init(this)})};b.fn[a].internalMethods={init:function(d){var c=this;base=c.getData(d),base.$elem=b(d),base.elemId=base.$elem.attr("id");if(base.options.elemHeight!=null){base.$elem.height(base.options.elemHeight)}this.ajaxLoading(d);this.preventContextMenu(d);this.prepareElements(d);this.setupDefaultProperty(d);base.$contentScrollerWrap.bind("scroll",{elem:d,that:this},this.contentScrollingHandle);base.$contentScrollerWrap.bind("scrollstop",{elem:d,that:this},this.contentScrollStopHandle);this.renderContent(d);this.getMaxGridWidth(d);this.ajaxLoadingComplete(d)},getData:function(c){return b.data(c,a)||{}},preventContextMenu:function(d){var c=this,e=c.getData(d);e.$elem.unbind("contextmenu").bind("contextmenu",function(f){f.preventDefault(f);return false})},prepareElements:function(d){var c=this,e=c.getData(d);e.$contentScrollerWrap=b("<div />").addClass("contentScrollerWrap").appendTo(e.$elem);e.$content=b("<div />").addClass("content").appendTo(e.$contentScrollerWrap);this.disableSelection(d,[e.$header,e.$content,e.$contentScrollerWrap])},setupDefaultProperty:function(d){var c=this,e=c.getData(d);e.perPageRows=Math.ceil(this.getContentHeight(d)/e.options.rowHeight);this.setupDefaultRange(d);if(e.options.setRootHighLight===true){e.highLightGUID=e.options.rootGUID}this.createGridData(d);e.expandGUID=["00000000-0000-0000-0000-000000000000"]},getContentHeight:function(d){var c=this,e=c.getData(d);return parseFloat(b.css(e.$elem[0],"height",true))},setupDefaultRange:function(d){var c=this,e=c.getData(d);if(e.options.scrollRowsBuffer==null){e.options.scrollRowsBuffer=Math.ceil(e.perPageRows/2)}e.renderRange={top:0,bottom:e.perPageRows+e.options.scrollRowsBuffer}},createGridData:function(g){var f=this,h=f.getData(g),c=h.options.data,e,i=0,d=0;h.GridData=new Array();e=h.GridData;e[0]=b.extend(true,{},{NAME:c.NAME,GUID:c.GUID,DEEP:0,GRID_DATA:[],CHILD:c.CHILD,CHILD_COUNT:c.CHILD.length,IS_EXPAND:true,NODE_DATA:c});b.each(c.CHILD,function(j,k){var l=b.extend({},h.defaultChild,{NAME:k.NAME,GUID:k.GUID,DEEP:1,PARENT:h.options.rootGUID,HAS_EXPAND_COLLAPSE_ICON:k.HAS_EXPAND_COLLAPSE_ICON,STATUS:k.STATUS||0,NODE_DATA:k});e.push(l);h.nodeData[k.GUID]=l;e[0].GRID_DATA.push(l);if(l.STATUS==0){d++}if(l.STATUS==2){i++}});e[0].STATUS=1;if(i==c.CHILD.length){e[0].STATUS=2}if(d==c.CHILD.length){e[0].STATUS=0}h.options.data=b.extend({},e[0]);h.nodeData[h.options.rootGUID]=h.options.data},removeContent:function(d){var c=this,e=c.getData(d);e.$content.empty()},renderContent:function(g){var f=this,h=f.getData(g),c,d,j,e=h.GridData;h.$content.height(e.length*h.options.rowHeight);h.contentHeight=this.getContentHeight(g);c=f.getRenderRange(g);if(c.bottom>h.GridData.length){c.bottom=h.GridData.length}this.createRows(g)},createRows:function(u){var e=this,c=e.getData(u),f,v={icon:{},checkBox:{},text:{}};function d(j){if(j.button!=2){return false}var i=j.data.$nodeDiv;if(c.options.fakeContextMenu){i.addClass(c.options.classUIselectedFake).siblings().removeClass(c.options.classUIselectedFake)}c.highLightGUIDTmp=c.highLightGUID;c.highLightGUID=j.data.o.GUID;c.options.onContextMenu(c.highLightGUID)}var h=c.renderRange,t=c.GridData,m,q=function(i){if(i.button===2){b(i.currentTarget).contextMenu(b.extend(true,{},c.options.contextMenu,i.data)).off(i)}},n=c.options.isShowRoot===false?1:0,g;if(h.bottom<c.perPageRows){h.bottom=c.perPageRows}var w=(b.inArray("icon",c.options.containerNode)!=-1);for(var r=h.top;r<h.bottom;r++){if(b("> div[node="+r+"]",c.$content).length>0){continue}m=t[r];if(!m){continue}var k=b('<div class="node"/>').attr({node:r,GUID:m.GUID}).css({top:(c.options.rowHeight*(r-n))});if(c.highLightGUID==m.GUID){k.addClass(c.options.classUIselected)}var l=b("<span/>").addClass("node-indent").appendTo(k);var s=b("<span/>").addClass("node-icons-text");v.text=b("<span/>").addClass("text").text(m.NAME);if(b.inArray("checkBox",c.options.containerNode)!=-1){v.checkBox=this.checkBoxForNode(u,m)}if(m.GUID==c.options.rootGUID){if(w){v.icon=b("<span/>").addClass("icons").addClass("icons-root").attr("border","0")}if(c.options.isShowRoot===false){k.hide()}}else{for(var p=0;p<m.DEEP;p++){$dotLine=b('<span class="dot-line dot-middle"/>').appendTo(l)}if(m.HAS_EXPAND_COLLAPSE_ICON&&m.CHILD_COUNT!=0){if(m.IS_EXPAND){f=b('<span style="float:left;"/>').addClass(c.options.classExpandCollapse).addClass(c.options.classIconExpand).data("is_expand",true).appendTo($dotLine)}else{f=b('<span style="float:left;"/>').addClass(c.options.classExpandCollapse).addClass(c.options.classIconCollapse).data("is_expand",false).appendTo($dotLine)}this.nodeExpand(u,m,r,f)}if(w){v.icon=b("<span/>").addClass("icons").addClass("icons-node").attr("border","0")}g=c.options.cellsFormat(v.icon,m,k)}b.each(c.options.containerNode,function(j,x){if(x){s.append(v[x])}});if(typeof g!="undefined"){s.append(g)}else{s.append(v.text)}s.appendTo(k);k.appendTo(c.$content);this.nodeEvent(u,k,m);if(c.options.contextMenu){k.filter(function(){if(c.options.searchResultDisableContextMenu===true){return(b(this).attr("guid")!=c.searchResultGUID)}else{return true}}).on("mousedown",{exclude:[l],hideContextMenu:function(){if(c.options.fakeContextMenu){c.$content.children("div.node").each(function(i,j){j=b(j);if(j.attr("guid")==c.highLightGUID){j.removeClass(c.options.classUIselectedFake);return false}})}c.options.unContextMenu(c.highLightGUID);c.highLightGUID=c.highLightGUIDTmp}},q);k.on("mouseup",{$nodeDiv:k,o:m},d)}else{}e.setupNodeWidth(u,m)}this.ajaxLoadingComplete(u,{delay:0})},checkBoxForNode:function(e,g){var d=this,f=d.getData(e),c;c=b("<span/>").addClass("icons").attr("border","0").addClass("icons-checkbox");if(g.PARENT!=undefined){if(f.nodeData[g.PARENT].STATUS===2){g.STATUS=2}if(f.nodeData[g.PARENT].STATUS===0){g.STATUS=0}}this.setCheckBoxIcon(e,c,g.STATUS);c.on("click",{o:g},function(i){var h=b(this);if(h.hasClass("off")){i.data.o.STATUS=2;f.nodeData[i.data.o.GUID].STATUS=2;d.setCheckBoxIcon(e,h,2);f.options.onChecked(f.nodeData[i.data.o.GUID])}else{i.data.o.STATUS=0;f.nodeData[i.data.o.GUID].STATUS=0;d.setCheckBoxIcon(e,h,0);f.options.unChecked(f.nodeData[i.data.o.GUID])}d.applyCheckedStatusToChild(e,i.data.o);i.preventDefault(i);return false});return c},applyCheckedStatusToChild:function(g,j){var f=this,h=f.getData(g),k;if(j.GUID==h.options.rootGUID){k=h.GridData.length-1}else{k=j.CHILD_COUNT}var e=0;for(e;e<h.GridData.length;e++){if(j.GUID==h.GridData[e].GUID){break}}e+=1;if(j.IS_EXPAND===true){var d=e+k;for(e;e<d;e++){var c=b("> div[node="+e+"]",h.$content).find(".icons-checkbox");this.setCheckBoxIcon(g,c,j.STATUS);h.GridData[e].STATUS=j.STATUS;h.nodeData[h.GridData[e].GUID].STATUS=j.STATUS}}if(j.PARENT!=undefined){this.applyCheckedStatusToParent(g,j.PARENT)}},applyCheckedStatusToParent:function(g,j){var f=this,h=f.getData(g);var e=0;if(j!=undefined){for(e;e<h.GridData.length;e++){if(j==h.GridData[e].GUID){break}}}var d=b("> div[node="+e+"]",h.$content).find(".icons-checkbox");this.setCheckBoxIcon(g,d,1);h.GridData[e].STATUS=1;h.nodeData[h.GridData[e].GUID].STATUS=1;var c=this.testParentStatus(g,h.nodeData[j].CHILD);h.nodeData[h.GridData[e].GUID].STATUS=c;h.GridData[e].STATUS=c;this.setCheckBoxIcon(g,d,c);if(j!=h.options.rootGUID){this.applyCheckedStatusToParent(g,h.nodeData[j].PARENT)}},testParentStatus:function(g,k){var f=this,h=f.getData(g),e=0,d=0,c=0,j=0;for(e;e<k.length;e++){if(h.nodeData[k[e].GUID].STATUS==0){d++}if(h.nodeData[k[e].GUID].STATUS==1){c++}if(h.nodeData[k[e].GUID].STATUS==2){j++}}if(d==k.length){return 0}else{if(j==k.length){return 2}else{return 1}}},setCheckBoxIcon:function(f,d,c){var e=this,g=e.getData(f);d.removeClass("off").removeClass("on").removeClass("half");switch(c){case 0:d.addClass("off");break;case 1:d.addClass("half");break;case 2:d.addClass("on");break;default:break}},nodeEvent:function(e,c,g){var d=this,f=d.getData(e);c.on("mouseover",function(){b(this).addClass(f.options.classUIHover)});c.on("mouseout",function(){b(this).removeClass(f.options.classUIHover)});c.on("click",{$content:f.$content,o:g},function(h){var j=this;b(this).addClass(f.options.classUIselected).siblings().removeClass(f.options.classUIselected);f.highLightGUID=h.data.o.GUID;var i=[function(){var k=b(this);if(b("span."+f.options.classExpandCollapse,j).length>0){b("span."+f.options.classExpandCollapse,j).trigger("click",[function(){f.options.selected({base:f,$node:k,data:g})}])}else{f.options.selected({base:f,$node:k,data:g})}setTimeout(function(){k.dequeue()})}];if(g.IS_EXPAND===false){if((h.button!==undefined&&f.options.triggerExpandAsSelected===true)||(h.button===undefined&&f.options.expandAndSelect===true)){b(this).queue(i)}else{f.options.selected({base:f,$node:b(this),data:g})}}else{if(g.CHILD_COUNT!=-1){f.options.selected({base:f,$node:b(this),data:g})}}h.preventDefault(h);return false})},nodeExpand:function(f,h,d,c){var e=this,g=e.getData(f);c.on("click",{o:h,i:d,that:this},function(u,p){var l=u.data.o,r=u.data.i,v=b(this),t=u.data.that,k=b.isFunction(p);if(l.CHILD===undefined){if(!g.nodeData[l.GUID].CHILD){var j=g.options.expand({data:l,i:r,expandOnly:!k});if(j===false){b(this).remove();if(k){p()}return false}}}if(v.data("is_expand")===true){v.data("is_expand",false).addClass(g.options.classIconCollapse).removeClass(g.options.classIconExpand);l.IS_EXPAND=false;t.removeGridDataToParent(f,g.nodeData[l.GUID],g.nodeData[l.GUID].CHILD_COUNT);t.collapseNode(f,(r+1))}else{v.data("is_expand",true).addClass(g.options.classIconExpand).removeClass(g.options.classIconCollapse);l.IS_EXPAND=true;if(g.nodeData[l.GUID].HIDE_CHILD.length>0){var s=g.GridData;var m=g.nodeData[l.GUID].HIDE_CHILD;var q=s.slice(0,r+1);var n=s.slice(r+1);g.GridData=q.concat(m).concat(n);g.$content.empty();t.increaseGridDataChildCount(f,g.nodeData[l.GUID],m.length);t.expandNode(f,r+1+m.length)}if(k){p()}if(l.CHILD){for(var r=0;r<l.CHILD.length;r++){if(l.STATUS===2){g.nodeData[l.CHILD[r].GUID].STATUS=2}if(l.STATUS===0){g.nodeData[l.CHILD[r].GUID].STATUS=0}}}}t.getMaxGridWidth(f);t.syncExpandGUID(f);u.preventDefault(u);return false})},syncExpandGUID:function(d){var c=this,e=c.getData(d);e.expandGUID=new Array();b.each(e.GridData,function(f,g){if(g.IS_EXPAND===true){e.expandGUID.push(g.GUID)}})},getExpandGUID:function(e,c){var d=this,f=d.getData(e);c(f.expandGUID)},renderNode:function(d,m,h){var k=this,c=k.getData(d);var j=c.GridData,i=m.data.CHILD_COUNT=h.CHILD.length||0;if(i>0){var l=m.i+1;var g=j.slice(0,l);var f=j.slice(l);var e=this.setDefaultNodeProperty(d,m,h.CHILD);c.GridData=g.concat(e).concat(f);this.expandNode(d,l);c.nodeData[m.data.GUID].CHILD=h.CHILD;c.nodeData[m.data.GUID].GRID_DATA=e;this.insertGridDataToParent(d,c.nodeData[m.data.GUID],e.length)}this.getMaxGridWidth(d);if(!c.nodeData[m.data.GUID].CHILD){c.$content.children("div.node").each(function(n,o){o=b(o);if(o.attr("guid")==m.data.GUID){o.find("span."+c.options.classExpandCollapse).remove();return false}})}},getMaxGridWidth:function(e,c){var d=this,f=d.getData(e);if(c){if(c<0){return false}f.$elem.width(parseInt(c,10))}else{f.$elem.width(parseInt(f.$elem.parent().width(),10))}f.maxWidth=f.$contentScrollerWrap[0].clientWidth;b.each(f.GridData,function(g,h){if(h.width>f.maxWidth){f.maxWidth=h.width}});if(f.maxWidth<0){return false}f.$content.width(f.maxWidth)},setDefaultNodeProperty:function(e,g,i){var d=this,f=d.getData(e),c=[],h=g.data.DEEP+1;b.each(i,function(j,k){var l=b.extend({},f.defaultChild,{NAME:k.NAME,GUID:k.GUID,DEEP:h,PARENT:g.data.GUID,HAS_EXPAND_COLLAPSE_ICON:k.HAS_EXPAND_COLLAPSE_ICON,STATUS:k.STATUS,NODE_DATA:k});c.push(l);f.nodeData[k.GUID]=l});return c},expandNode:function(e,c){var d=this,f=d.getData(e);this.removeAfterRows(e,c);this.renderContent(e)},removeAfterRows:function(f,c){var e=this,g=e.getData(f);for(var d=c;d<g.renderRange.bottom;d++){b("> div[node="+d+"]",g.$content).remove()}},insertGridDataToParent:function(f,e,c){var d=this,g=d.getData(f);if(!e.PARENT){return false}this.insertGridDataPositionWithParent(f,e,c);this.insertGridDataToParent(f,g.nodeData[e.PARENT],c)},insertGridDataPositionWithParent:function(e,d,q){var k=this,c=k.getData(e),n=d.PARENT,l=d.GUID,g=c.nodeData[n].GRID_DATA,m=0;for(var j=0;j<g.length;j++){if(g[j].GUID==l){m=j;break}}var h=g.slice(0,j+1);var f=g.slice(j+1+q);var p=d.GRID_DATA;c.nodeData[n].CHILD_COUNT+=q},removeGridDataToParent:function(f,e,d){var c=this,g=c.getData(f);if(!e.PARENT){return false}this.reduceGridDataChildCount(f,e,d);this.removeGridDataPositionWithParent(f,e,d)},reduceGridDataChildCount:function(g,f,e){var d=this,h=d.getData(g);if(!f.PARENT){return false}var c=f.PARENT;h.nodeData[c].CHILD_COUNT-=e;this.reduceGridDataChildCount(g,h.nodeData[f.PARENT],e)},removeGridDataPositionWithParent:function(f,d,r){var m=this,c=m.getData(f),q=d.PARENT,n=d.GUID,h=c.GridData,p=0,e=[];for(var k=0;k<h.length;k++){if(h[k].GUID==n){p=k;break}}var l=k+r;while(p<l){p++;e.push(h[p])}var j=h.slice(0,k+1);var g=h.slice(k+1+r);c.GridData=j.concat(g);c.nodeData[n].HIDE_CHILD=e},collapseNode:function(e,c){var d=this,f=d.getData(e);this.removeAfterRows(e,c);this.renderContent(e);this.getMaxGridWidth(e)},increaseGridDataChildCount:function(g,f,d){var e=this,h=e.getData(g);if(!f.PARENT){return false}var c=f.PARENT;h.nodeData[c].CHILD_COUNT+=d;this.increaseGridDataChildCount(g,h.nodeData[f.PARENT],d)},contentScrollingHandle:function(h){var f=h.data.that,d=h.data.elem,g=f.getData(d),i,c;g.scrollTop=this.scrollTop;g.scrollLeft=this.scrollLeft;g.clientWidth=this.clientWidth;if(g.scrollTop!==g.prevScrollTop){f.removeContextMenu(d);g.vDiff=g.scrollTop-g.prevScrollTop;g.absScrollDiff=Math.abs(g.vDiff);f.dynamicRequestLoading(d)}},contentScrollStopHandle:function(g){var d=g.data.that,c=g.data.elem,f=d.getData(c),h;f.scrollTop=this.scrollTop;f.scrollLeft=this.scrollLeft;if(f.scrollTop!==f.prevScrollTop){f.vDiff=f.scrollTop-f.prevScrollTop;f.absTopPosition+=f.vDiff;setTimeout(function(){d.appendRow(c);d.getMaxGridWidth(c)},f.scrollRenderRowsTimeout);f.prevScrollTop=f.scrollTop}if(f.scrollTop!==f.prevScrollTop){f.prevScrollLeft=f.scrollLeft}},appendRow:function(e){var d=this,f=d.getData(e);var c=this.getRenderRange(e);if(c){this.createRows(e);f.absScrollDiff=0}},getRenderRange:function(f){var e=this,g=e.getData(f),h,c,i,d=g.GridData;g.perPageRows=Math.ceil(g.contentHeight/g.options.rowHeight);if(g.absScrollDiff<g.rowHeight){return false}if(g.absScrollDiff>g.contentHeight){g.$content.empty()}h=Math.floor((g.absTopPosition)/g.options.rowHeight)-g.options.scrollRowsBuffer;if(h<0){h=0}c=Math.ceil((g.absTopPosition+g.contentHeight)/g.options.rowHeight)+g.options.scrollRowsBuffer;i=d.length;if(c>=i){c=i}g.renderRange={top:h,bottom:c};if(g.absScrollDiff<g.contentHeight){this.removeSiblingRows(f)}return g.renderRange},removeSiblingRows:function(f){var e=this,h=e.getData(f),j=h.renderRange.top,c=h.renderRange.bottom,k=j-h.perPageRows,g=c+h.perPageRows;for(var d=k;d<j;d++){b("> div[node="+d+"]",h.$content).remove()}for(var d=c;d<g;d++){b("> div[node="+d+"]",h.$content).remove()}},setupNodeWidth:function(f,e){var d=this,g=d.getData(f),h,c;if(e){c=0;g.$content.children("div.node").each(function(i,j){j=b(j);if(j.attr("guid")==e.GUID){h=j.children();h.each(function(l,k){c+=b(k).outerWidth()});return false}});e.width=c;g.nodeData[e.GUID].width=c}},ajaxLoading:function(g,e){var f=this,h=f.getData(g);h.$elem=b(g);if(h.$elem.find(".ajax-loading").length>0){return false}var c=b("<div />").addClass("ajax-loading").appendTo(h.$elem);var d=b("<div />").addClass("message").appendTo(c);this.disableSelection(g,c);d.css({left:(c.width()-d.width())/2,top:(c.height()-d.height())/2})},ajaxLoadingComplete:function(e,c){var d=this,g=d.getData(e);var f=g.ajaxLoadingRemoveTimeout;if(c&&c.delay){f=c.delay}setTimeout(function(){g.$elem.find("div.ajax-loading").remove()},f)},getSelectedGUID:function(e,d){var c=this,f=c.getData(e);d(f.highLightGUID)},adjHeight:function(e,c){var d=this,f=d.getData(e);if(c<0){return false}if(!c){c=parseInt(f.$elem.height(),10)}else{f.$elem.height(c)}f.$contentScrollerWrap.height(c);f.contentHeight=c;f.absScrollDiff=c;this.appendRow(e);this.getMaxGridWidth(e)},triggerExpand:function(h,d){var g=this,j=g.getData(h),k,e=0;d=b.extend(true,{},{expandAndSelect:false,offset:2},d);j.options.expandAndSelect=d.expandAndSelect;for(e;e<j.GridData.length;e++){if(j.GridData[e].GUID==d.GUID){k=j.GridData[e];break}}e-=d.offset;if(j.options.fakeContextMenu){j.$contentScrollerWrap[0].scrollTop=e*j.options.rowHeight}var f=new Date().getTime();var c=function(){var o,m,i,l,n=1000;j.$content.children("div.node").each(function(p,q){q=b(q);if(q.attr("guid")==d.GUID){i=q;return false}});if(!i){l=new Date().getTime()-f;if(l>n){return}}else{o=i.find("span."+j.options.classExpandCollapse);l=new Date().getTime()-f;if(d.expandAndSelect===true){m=i.find("span.node-icons-text");if(m.length>0||l>n){m.trigger("click");return}}else{if(o.length>0||l>n){if(k.IS_EXPAND===false){o.trigger("click")}return}}}setTimeout(arguments.callee,300)};c()},triggerSelect:function(h,d){var g=this,j=g.getData(h),e=0;d=b.extend(true,{},{expandAndSelect:false,offset:2},d);j.options.expandAndSelect=d.expandAndSelect;for(e;e<j.GridData.length;e++){if(j.GridData[e].GUID==d.GUID){break}}e-=d.offset;if(j.options.fakeContextMenu){j.$contentScrollerWrap[0].scrollTop=e*j.options.rowHeight}var f=new Date().getTime();var c=function(){var l,i,k,m=1000;j.$content.children("div.node").each(function(n,o){o=b(o);if(o.attr("guid")==d.GUID){i=o;return false}});if(!i){k=new Date().getTime()-f;if(k>m){return}}else{l=i.find("span.node-icons-text");k=new Date().getTime()-f;if(l.length>0||k>m){l.trigger("click");return}}setTimeout(arguments.callee,300)};c()},renderSearchResultNode:function(g,c){var f=this,h=f.getData(g),e=c.searchResult.data,d=0;h.searchResultGUID=c.searchResult.data.GUID;if(c.searchResultDisableContextMenu===false){h.options.searchResultDisableContextMenu=c.searchResultDisableContextMenu}var j=b.extend({},h.defaultChild,{NAME:e.NAME,GUID:e.GUID,DEEP:1,PARENT:h.options.rootGUID,HAS_EXPAND_COLLAPSE_ICON:false,STATUS:e.STATUS||0,NODE_DATA:e});if(h.GridData[h.GridData.length-1].GUID!=h.options.searchResult.data.GUID){h.GridData.push(j);h.nodeData[h.searchResultGUID]=j;this.renderContent(g)}this.triggerSelect(g,{GUID:h.options.searchResult.data.GUID});h.$contentScrollerWrap[0].scrollLeft=0},setHighLightGUID:function(d,f){var c=this,e=c.getData(d);e.highLightGUID=f},refresh:function(d,f){var c=this,e=c.getData(d);if(f){this.rebuildGridData(d,f);this.removeContent(d);this.renderContent(d)}else{this.removeContent(d);this.renderContent(d)}},disableSelection:function(d,f){var c=this,e=c.getData(d);b.each(f,function(g,h){b(h).attr("unselectable","on").css({"-moz-user-select":"none","-o-user-select":"none","-khtml-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none"}).attr("unselectable","on").on("selectstart",function(){return false})})},rebuildGridData:function(e,g){var d=this,f=d.getData(e),c=f.options.data;for(key in g){if(g[key].CHILD){delete (f.nodeData[key].CHILD)}}b.extend(true,f.nodeData,g);f.GridData=new Array();GridData=f.GridData;GridData[0]=b.extend(true,{},f.nodeData[f.options.rootGUID]);this.rebuildChildGridData(e,GridData,f.nodeData[f.options.rootGUID]);if(f.searchResultGUID!=""){f.GridData.push(f.nodeData[f.searchResultGUID])}},rebuildChildGridData:function(g,d,f){var e=this,h=e.getData(g),c=h.options.data;if(f){f.HIDE_CHILD=[];if(f.CHILD){b.each(f.CHILD,function(j,k){if(!h.nodeData[k.GUID]){b.extend(true,k,h.defaultChild,{DEEP:(f.DEEP+1),PARENT:f.GUID});h.nodeData[k.GUID]=k}b.extend(true,h.nodeData[k.GUID],k);h.nodeData[k.GUID].HIDE_CHILD=new Array();if(h.nodeData[k.GUID].IS_EXPAND===true){h.nodeData[k.GUID].CHILD_COUNT=0}else{h.nodeData[k.GUID].CHILD_COUNT=-1;delete (h.nodeData[k.GUID].CHILD)}e.rebuildChildCount(g,h.nodeData[k.GUID]);d.push(h.nodeData[k.GUID]);if(h.nodeData[k.GUID].IS_EXPAND===true){e.rebuildChildGridData(g,d,h.nodeData[k.GUID])}})}}},rebuildChildCount:function(e,d){var c=this,f=c.getData(e);if(d.PARENT){f.nodeData[d.PARENT].CHILD_COUNT+=1;c.rebuildChildCount(e,f.nodeData[d.PARENT])}},scrollTo:function(f,c){var e=this,g=e.getData(f),d=b.extend({},{x:false,y:false},c);if(d.x!==false){g.$contentScrollerWrap[0].scrollLeft=d.x}if(d.y!==false){g.$contentScrollerWrap[0].scrollTop=d.y;if(d.y===0){this.setupDefaultRange(f)}}},dynamicRequestLoading:function(d){var c=this,e=c.getData(d);var f=e.options.scrollRowsBuffer*e.options.rowHeight;if(e.vDiff>=f){this.ajaxLoadingAsScrollingDown(d)}if(e.vDiff<=-1*f){this.ajaxLoadingAsScrollingUp(d)}},ajaxLoadingAsScrollingUp:function(h,d){var g=this,i=g.getData(h);i.$elem=b(h);if(i.$elem.find(".ajax-loading").length>0){return false}var e=b("<div />").addClass("ajax-loading").css("background-image","none").appendTo(i.$elem);var f=b("<div />").addClass("message").appendTo(e);this.disableSelection(h,e);var j=0;var c=f.height()*2;e.css({top:j,height:c,width:i.$contentScrollerWrap[0].clientWidth});if(c>0){f.css({left:(e.width()-f.width())/2,top:(e.height()-f.height())/2})}e.css("width","0px")},ajaxLoadingAsScrollingDown:function(g){var f=this,h=f.getData(g);h.$elem=b(g);if(h.$elem.find(".ajax-loading").length>0){return false}var d=b("<div />").addClass("ajax-loading").css("background-image","none").appendTo(h.$elem);var e=b("<div />").addClass("message").appendTo(d);this.disableSelection(g,d);var c=e.height()*2;var i=h.$contentScrollerWrap[0].clientHeight-c;d.css({top:i,height:c,width:h.$contentScrollerWrap[0].clientWidth});if(c>0){e.css({left:(d.width()-e.width())/2,top:(d.height()-e.height())/2})}d.css("width","0px")},getSelectedNode:function(g,e){var f=this,h=f.getData(g),d=0,c=h.nodeData[h.options.rootGUID],j=c.CHILD;h.selectedStatus.OFF=[];h.selectedStatus.HALF=[];h.selectedStatus.ON=[];this.setSelectedStatusProperty(g,c);if(c.STATUS==1){this.setChildSelectedNode(g,c)}if(b.isFunction(e)){e(h.selectedStatus)}},setChildSelectedNode:function(h,g){var f=this,j=f.getData(h),c=g.STATUS,k=g.CHILD,e,d=0;if(g.CHILD_COUNT!=-1){for(d;d<k.length;d++){e=j.nodeData[k[d].GUID];this.setSelectedStatusProperty(h,e);if(e.STATUS==1){this.setChildSelectedNode(h,e)}}}},setSelectedStatusProperty:function(e,d){var c=this,f=c.getData(e);switch(d.STATUS){case 0:f.selectedStatus.OFF.push(d.GUID);break;case 1:f.selectedStatus.HALF.push(d.GUID);break;case 2:f.selectedStatus.ON.push(d.GUID);break;default:break}},removeContextMenu:function(c){b(document).trigger("closeContextMenu")}};b.fn[a].publicMethods={renderNode:function(d,c){b.fn[a].internalMethods.renderNode(d,c[0],c[1])},ajaxLoading:function(d,c){b.fn[a].internalMethods.ajaxLoading(d,c[0])},ajaxLoadingComplete:function(d,c){b.fn[a].internalMethods.ajaxLoadingComplete(d,c[0])},getSelectedGUID:function(d,c){b.fn[a].internalMethods.getSelectedGUID(d,c[0])},adjHeight:function(d,c){b.fn[a].internalMethods.adjHeight(d,c[0])},adjWidth:function(d,c){b.fn[a].internalMethods.getMaxGridWidth(d,c[0])},triggerExpand:function(d,c){b.fn[a].internalMethods.triggerExpand(d,c[0])},triggerSelect:function(d,c){b.fn[a].internalMethods.triggerSelect(d,c[0])},renderSearchResultNode:function(d,c){b.fn[a].internalMethods.renderSearchResultNode(d,c[0])},refresh:function(d,c){b.fn[a].internalMethods.refresh(d,c[0])},getExpandGUID:function(d,c){b.fn[a].internalMethods.getExpandGUID(d,c[0])},setHighLightGUID:function(d,c){b.fn[a].internalMethods.setHighLightGUID(d,c[0])},scrollTo:function(d,c){b.fn[a].internalMethods.scrollTo(d,c[0])},getSelectedNode:function(d,c){b.fn[a].internalMethods.getSelectedNode(d,c[0])},removeContextMenu:function(d,c){b.fn[a].internalMethods.removeContextMenu(d,c[0])}};b.fn[a].defaults=b.extend({},{classIconCollapse:"icon-collapse",classIconExpand:"icon-expand",classExpandCollapse:"expand-collapse",classUIHover:"ui-hover",classUIselected:"ui-selected",fakeContextMenu:true,classUIselectedFake:"ui-selected-fake",scrollRowsBuffer:50,rowHeight:20,rootGUID:"00000000-0000-0000-0000-000000000000",isShowRoot:true,setRootHighLight:true,triggerExpandAsSelected:false,selected:function(c){},expand:function(c){return false},searchResult:{data:{NAME:"Search result",GUID:"search-result"}},onContextMenu:function(c){return true},unContextMenu:function(c){return true},searchResultDisableContextMenu:true,elemHeight:null,containerNode:["icon"],onChecked:function(c){return true},unChecked:function(c){return true},cellsFormat:function(c,e,d){}});b.fn[a].base=b.extend({},{scrollTop:0,prevScrollTop:0,scrollLeft:0,prevScrollLeft:0,absScrollDiff:0,scrollRenderRowsTimeout:100,absTopPosition:0,renderRange:{top:0,bottom:20},perPageRows:"",highLightGUID:null,GridData:[],nodeData:{},maxWidth:0,ajaxLoadingRemoveTimeout:500,expandGUID:[],selectedStatus:{OFF:[],HALF:[],ON:[]},defaultChild:{STATUS:0,IS_EXPAND:false,HAS_EXPAND_COLLAPSE_ICON:true,CHILD_COUNT:-1,GRID_DATA:[],HIDE_CHILD:[]},searchResultGUID:""})})(jQuery);